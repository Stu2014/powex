package com.gt.controller.front;

import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.List;

import javax.servlet.http.HttpServletRequest;

import net.sf.json.JSONArray;
import net.sf.json.JSONObject;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import com.gt.controller.BaseController;
import com.gt.entity.Fentrust;
import com.gt.entity.Fentrustlog;
import com.gt.entity.Ftradehistory;
import com.gt.entity.Ftrademapping;
import com.gt.service.front.FrontCacheService;
import com.gt.service.front.FrontConstantMapService;
import com.gt.service.front.FrontMarketJsonService;
import com.gt.service.front.FtradeMappingService;
import com.gt.util.Utils;



@Controller
public class FrontMarketJsonController extends BaseController {

	@Autowired
	private FrontConstantMapService frontConstantMapService;
	@Autowired
	private FtradeMappingService ftradeMappingService;
	@Autowired
	private FrontMarketJsonService frontMarketJsonService;
	@Autowired
	private FrontCacheService frontCacheService;	
	//交易中心
	@ResponseBody
	@RequestMapping(value="/real/market",produces={JsonEncode})
	public String marketRefresh(
			HttpServletRequest request,
			@RequestParam(required=false,defaultValue="0")int symbol
			) throws Exception{
		
		Ftrademapping ftrademapping = this.ftradeMappingService.findFtrademapping(symbol) ;
		if(ftrademapping == null ){
			return null ;
		}
		
		//加权参数
		Double adjustnum = 1d;
		if (frontConstantMapService.get("adjustvalue")!=null){
			adjustnum = Double.valueOf(frontConstantMapService.getString("adjustvalue"));
		}
		
		if(adjustnum<0.75){
			adjustnum= 0.75;
		}
		if (adjustnum>1.85){
			adjustnum =1.85;
		}
		
		return frontMarketJsonService.marketRefresh(symbol);
	}
	
	
	//K线中心
	@ResponseBody
	@RequestMapping(value="/real/market2",produces={JsonEncode})
	public String marketRefresh2(
			HttpServletRequest request,
			@RequestParam(required=false,defaultValue="0")int symbol
			) throws Exception{
		Ftrademapping ftrademapping = this.ftradeMappingService.findFtrademapping(symbol) ;
		if(ftrademapping == null ){
			return null ;
		}
		//System.out.println(frontMarketJsonService.marketRefresh2(symbol));
		return frontMarketJsonService.marketRefresh2(symbol);
	}
	
	
	@ResponseBody
	@RequestMapping("/kline/fullperiod")
	public String period(
			@RequestParam(required=true)int step,
			@RequestParam(required=true)int symbol
			) throws Exception{
		//System.out.println(frontMarketJsonService.period(step, symbol));
		return frontMarketJsonService.period(step, symbol);
		//return "[[1536701400000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536702300000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536703200000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536704100000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536705000000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536705900000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536706800000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536707700000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536708600000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536709500000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536710400000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536711300000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536712200000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536713100000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536714000000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536714900000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536715800000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536716700000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536717600000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536718500000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536719400000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536720300000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536721200000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536722100000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536723000000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536723900000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536724800000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536725700000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536726600000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536727500000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536728400000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536729300000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536730200000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536731100000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536732000000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536732900000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536733800000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536734700000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536735600000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536736500000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536737400000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536738300000,700.18000000,700.18000000,285.00000000,700.18000000,0.0000],[1536739200000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536740100000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536741000000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536741900000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536742800000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536743700000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536744600000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536745500000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536746400000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536747300000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536748200000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536749100000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536750000000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536750900000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536751800000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536752700000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536753600000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536754500000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536755400000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536756300000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536757200000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536758100000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536759000000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536759900000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536760800000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536761700000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536762600000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536763500000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536764400000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536765300000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536766200000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536767100000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536768000000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536768900000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536769800000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536770700000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536771600000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536772500000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536773400000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536774300000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536775200000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536776100000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536777000000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536777900000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536778800000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536779700000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536780600000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536781500000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536782400000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536783300000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536784200000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536785100000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536786000000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536786900000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536787800000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536788700000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536789600000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536790500000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536791400000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536792300000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536793200000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536794100000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536795000000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536795900000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536796800000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536797700000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536798600000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536799500000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536800400000,700.18000000,700.18000000,0E-8,0E-8,0.0000],[1536801300000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536802200000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536803100000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536804000000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536804900000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536805800000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536806700000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536807600000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536808500000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536809400000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536810300000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536811200000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536812100000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536813000000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536813900000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000],[1536814800000,700.18000000,700.18000000,700.18000000,700.18000000,0.0000]]";
		 }
	
	@ResponseBody
	@RequestMapping("/kline/fulldepth")
	public String depth(
			@RequestParam(required=true)int symbol,
			@RequestParam(required=true)int step
			) throws Exception{
		
		//System.out.println(frontMarketJsonService.depth(symbol, step));
		return frontMarketJsonService.depth(symbol, step);
		//return "{\"depth\":{\"bids\":[],\"asks\":[],\"date\":1537151629},\"period\":{\"marketFrom\":14,\"coinVol\":14,\"type\":900,\"data\":[[1537151400000,700.18,700.18,700.18,700.18,0]]}}" ;
	}
	
	@ResponseBody
	@RequestMapping("/kline/trade_json")
	public String trade_json(
			@RequestParam(required=true )int id
			) throws Exception {
		
		return frontMarketJsonService.trade_json(id);
	}
	
}
